enum AdvanceStatus {
  Pending
  Active
  Revoked
  Recouped
  Expired
}

enum ExpenseKind {
  AdvanceRepaid
  AdvanceCreated
  AdvanceProvided
  AdvanceRevoked
  ERC20Transfer
  ERC20Approve
}

type Stats @entity(immutable: false) {
  id: String!
  contractsCount: BigInt!
  expensesCount: BigInt!
}

type AdvanceContractCollateral @entity(immutable: true) {
  id: Bytes!
  advanceContract: AdvanceContract!
  tokenAddress: Bytes! # address
  tokenId: BigInt!
  tokenAmount: BigInt!
}

type AdvanceContract @entity(immutable: false) {
  id: Bytes!
  advanceContract: Bytes! # address
  creator: Bytes! # address
  recipient: Bytes! # address
  collateralReceiver: Bytes! # address
  isPackAdvance: Boolean!
  collaterals: [AdvanceContractCollateral!]! @derivedFrom(field: "advanceContract")
  advanceAmount: BigInt!
  recoupmentAmount: BigInt!
  repaidAmount: BigInt!
  actualRepaid: BigInt!
  feePpm: BigInt!
  status: AdvanceStatus!
  timestamp: BigInt!
  transactionHash: Bytes!
  expenses: [Expense!]! @derivedFrom(field: "advanceContract")
  advanceRepaid: AdvanceRepaid
  paymentTokenAddress: Bytes!
  templateAddress: Bytes!
  expirationDate: BigInt!
  offerDuration: BigInt!
}

type Expense @entity(immutable: true) {
  id: Bytes!
  from: Bytes
  advanceContract: AdvanceContract!
  collaterals: [AdvanceContractCollateral!]!
  transactionHash: Bytes!
  kind: ExpenseKind!
  value: BigInt
  baseFeePerGas: BigInt
  gasLimit: BigInt!
  gasPrice: BigInt! # format to gwei
  gasUsed: BigInt
  cumulativeGasUsed: BigInt
  totalCost: BigInt! # format to ETH
  timestamp: BigInt!
}

type AdvanceProvided @entity(immutable: true) {
  id: Bytes!
  advancer: Bytes!
  timestamp: BigInt!
  transactionHash: Bytes!
}

type AdvancePartiallyRepaid @entity(immutable: true) {
  id: Bytes!
  advanceContract: Bytes!
  repaymentAmount: BigInt!
  timestamp: BigInt!
  transactionHash: Bytes!
}

type AdvanceRepaid @entity(immutable: true) {
  id: Bytes!
  advanceContract: Bytes!
  repaymentAmount: BigInt!
  timestamp: BigInt!
  transactionHash: Bytes!
}

type AdvanceRevoked @entity(immutable: true) {
  id: Bytes!
  advanceContract: Bytes!
  timestamp: BigInt!
  transactionHash: Bytes!
}
