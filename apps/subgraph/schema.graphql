enum LoanStatus {
  Pending
  Active
  Revoked
  Recouped
  Expired
}

enum ExpenseKind {
  LoanRepaid
  LoanCreated
  LoanProvided
  LoanRevoked
  ERC20Transfer
  ERC20Approve
}

type Stats @entity(immutable: false) {
  id: String!
  contractsCount: BigInt!
  expensesCount: BigInt!
}

type LoanContractCollateral @entity(immutable: true) {
  id: Bytes!
  loanContract: LoanContract!
  tokenAddress: Bytes! # address
  tokenId: BigInt!
  tokenAmount: BigInt!
}

type LoanContract @entity(immutable: false) {
  id: Bytes!
  loanContract: Bytes! # address
  borrower: Bytes! # address
  isPackLoan: Boolean!
  collaterals: [LoanContractCollateral!]! @derivedFrom(field: "loanContract")
  loanAmount: BigInt!
  recoupmentAmount: BigInt!
  repaidAmount: BigInt!
  actualRepaid: BigInt!
  feePpm: BigInt!
  status: LoanStatus!
  timestamp: BigInt!
  transactionHash: Bytes!
  expenses: [Expense!]! @derivedFrom(field: "loanContract")
  loanRepaid: LoanRepaid
  paymentTokenAddress: Bytes!
  templateAddress: Bytes!
  expirationDate: BigInt!
  offerDuration: BigInt!
}

type Expense @entity(immutable: true) {
  id: Bytes!
  from: Bytes
  loanContract: LoanContract!
  collaterals: [LoanContractCollateral!]!
  transactionHash: Bytes!
  kind: ExpenseKind!
  value: BigInt
  baseFeePerGas: BigInt
  gasLimit: BigInt!
  gasPrice: BigInt! # format to gwei
  gasUsed: BigInt
  cumulativeGasUsed: BigInt
  totalCost: BigInt! # format to ETH
  timestamp: BigInt!
}

type LoanProvided @entity(immutable: true) {
  id: Bytes!
  lender: Bytes!
  timestamp: BigInt!
  transactionHash: Bytes!
}

type LoanPartialyRepaid @entity(immutable: true) {
  id: Bytes!
  loanContract: Bytes!
  repaymentAmount: BigInt!
  timestamp: BigInt!
  transactionHash: Bytes!
}

type LoanRepaid @entity(immutable: true) {
  id: Bytes!
  loanContract: Bytes!
  repaymentAmount: BigInt!
  timestamp: BigInt!
  transactionHash: Bytes!
}

type LoanRevoked @entity(immutable: true) {
  id: Bytes!
  loanContract: Bytes!
  timestamp: BigInt!
  transactionHash: Bytes!
}
